@model BookSeatsViewModel
@{
    ViewData["Title"] = "Book Seats for " + Model.Movie.Title;
}

<h2>Book Seats for @Model.Movie.Title</h2>

<form method="post" action="@Url.Action("ConfirmBooking", new { movieId = Model.Movie.MovieId })" id="bookingForm">
    <input type="hidden" name="selectedSeats" id="selectedSeatIds" />

    <div class="row">
        <div class="col-md-12">
            <h3>Select Your Seats</h3>

             <!-- Seat Layout -->

            @foreach (var rowGroup in Model.Movie.RowGroups)
            {
                <div class="row-group">
                    <h4>@rowGroup.GroupName (Price: @rowGroup.Price.ToString("C"))</h4>

                    <div class="seat-layout">
                        @foreach (var seat in rowGroup.Seats.OrderBy(s => s.RowName).ThenBy(s => s.ColumnName))
                        {
                            <label class="seat-label">
                                <input type="checkbox"
                                       class="seat-checkbox"
                                       data-seat-id="@seat.SeatId"
                                       data-seat-name="Row @seat.RowName, Column @seat.ColumnName"
                                       data-price="@seat.RowGroup.Price"
                                       name="selectedSeats"
                                       value="@seat.SeatId"
                                @(seat.IsBooked ? "disabled" : "") />
                                <img src="~/logo/chair.png" alt="Chair Image" class="seat-image" />
                             @*    <span>Row @seat.RowName, Column @seat.ColumnName</span> *@
                            </label>
                            <br />
                        }
                    </div>
                </div>
            }


            <!-- Display Total Price -->
            <div>
                <strong>Total Price: </strong><span id="totalPrice">0.00</span>
            </div>
        </div>
    </div>

    <!-- Customer Name -->
    <div>
        <label for="customerName">Your Name</label>
        <input type="text" id="customerName" name="customerName" required />
    </div>

    <button type="submit" class="btn btn-primary">Confirm Booking</button>
</form>

<script>
    // For calculating total price and updating the selected seats (client-side)
    const seatCheckboxes = document.querySelectorAll('.seat-checkbox');
    const selectedSeats = new Set();  // To store selected seat ids
    let totalPrice = 0;

    seatCheckboxes.forEach(checkbox => {
        checkbox.addEventListener('change', function () {
            const price = parseFloat(this.getAttribute('data-price'));

            if (this.checked) {
                selectedSeats.add(this.value);  // Add seat to the selection
                totalPrice += price;  // Add price to the total
            } else {
                selectedSeats.delete(this.value);  // Remove seat from selection
                totalPrice -= price;  // Subtract price from total
            }

            document.getElementById('totalPrice').innerText = totalPrice.toFixed(2);

            // Update the hidden input with selected seat ids
            document.getElementById('selectedSeatIds').value = Array.from(selectedSeats).join(',');
        });
    });
</script>
